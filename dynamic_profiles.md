# alternative to PythonProfiles

many consumers already use scripts to generate profiles in their CI systems.

these scripts aren't necessarily written in python, they could be in bash/perl/ruby/js/php/m4/whatever.

usually, they could do something like:

```
./gen_profile.pl
```

or in generic case:

```
./gen_profile.pl --arg1 --arg2 ... --argN
```

## PythonProfiles

the current suggestion is:

```
if platform.system() == “Windows”:
    settings.os = “Windows”
    settings.arch = “x86_64”
else:
    settings.os = “Linux”
```

IMO, the example is too synthetic and could be easily replaced by two profiles
```
$ cat windows.profile
settings.os = Windows
settings.arch = x86_64

$ cat linux.profile
settings.os = Linux
```

this could be also easily generated by something like:
```
#!/bin/bash

if [ "$1" = "windows" ]
then
  echo "settings.os = Windows"
  echo "settings.arch = x86_64"
else
  echo "settings.os = Linux"
fi
```

and then it could be easily used as:
```
$ ./gen_profile.sh windows
settings.os = Windows
settings.arch = x86_64

$ ./gen_profile.sh linux
settings.os = Linux
```

in general the approach already works for any kind of scripts (or even compiled executables such as written in C++/Go/Java/etc).

it already supports everything needed, e.g. environment variables substituion.

### env substitution example

```
$ cat gen_profile_env.sh
#!/bin/bash

echo "settings.os = $MY_OS"
echo "settings.arch = $MY_ARCH"
```
```
$ MY_OS=Windows MY_ARCH=x86_64 ./gen_profile_env.sh
settings.os = Windows
settings.arch = x86_64
```

## UX problem

the main problem is that right now profiles aren't really first class entities in conan UX.

conan CLI doesn't operate on profiles - it operates on profile names. it basically means profiles has to exist on disk before it could be used on conan.

the only alternative is to specify everything manually (`-s os=Windows -s arch=x86_64`), which is execssive (altough, scripts could easily generate that command line as well, if needed).

given the above, user currently has to do:

```
./gen_profile.sh windows > profile.windows
conan install zlib/1.2.11@ --profile profile.windows
```

this works already, and it's convinient, but it's a bit redundant. it could be improved:

```
./gen_profile.sh windows | conan install zlib/1.2.11@ --profile stdin
```

which is comaptible with old approach:
```
cat profile.windows | conan install zlib/1.2.11@ --profile stdin
```

okay, what might be a tricky to work with 2 profiles (build/host), as you can't pipe them that easy (or you need to pipe one into stderr, which is ugly).

so, maybe instead we could instruct conan to use profile script instead of profile:

```
conan install zlib/1.2.11@ --profile-script "./gen_profile.sh --windows"
conan install zlib/1.2.11@ --profile-script:build "./gen_profile_build.sh --windows" --profile-script:host "./gen_profile_host.sh --linux"
```

## advantages

- similar to CGI interface
- it works well with already written scripts to generate profiles
- it supports arbitrary scripts (bash/perl/ruby/m4/etc), not just python
- conan doesn't need to have a complex logic to support python profiles
- python profiles don't need to declare special classes, they can just output generated profile to stdout
- probably, it's not even needed to implement in conan client, if we allow command line extensions (another idea suggested earlier)

# alternative to PythonProfiles

many consumers already use scripts to generate profiles in their CI systems.

these scripts aren't necessarily written in python, they could be in bash/perl/ruby/js/php/m4/awk/whatever.

usually, they could do something like:

```
./gen_profile.pl
```

or in generic case:

```
./gen_profile.pl --arg1 --arg2 ... --argN
```

## PythonProfiles

the current suggestion is:

```
if platform.system() == “Windows”:
    settings.os = “Windows”
    settings.arch = “x86_64”
else:
    settings.os = “Linux”
```

IMO, the example is too synthetic and could be easily replaced by two profiles
```
$ cat windows.profile
settings.os = Windows
settings.arch = x86_64

$ cat linux.profile
settings.os = Linux
```
but anyway, let's use this suggested example as a reference for now.

## scripted profiles

this could be also easily generated by something like:
```
#!/bin/bash

if [ "$1" = "windows" ]
then
  echo "settings.os = Windows"
  echo "settings.arch = x86_64"
else
  echo "settings.os = Linux"
fi
```

and then it could be easily used as:
```
$ ./gen_profile.sh windows
settings.os = Windows
settings.arch = x86_64

$ ./gen_profile.sh linux
settings.os = Linux
```

in general the approach already works for any kind of scripts (or even compiled executables such as written in C++/Go/Java/etc).

it already supports everything needed, e.g. environment variables substituion.

### env substitution example

```
$ cat gen_profile_env.sh
#!/bin/bash

echo "settings.os = $MY_OS"
echo "settings.arch = $MY_ARCH"
```
```
$ MY_OS=Windows MY_ARCH=x86_64 ./gen_profile_env.sh
settings.os = Windows
settings.arch = x86_64
```

## UX problem

the main problem is that right now profiles aren't really first class entities in conan UX.

conan CLI doesn't operate on profiles - it operates on profile names. it basically means profiles has to exist on disk before it could be used on conan.

the only alternative is to specify everything manually (`-s os=Windows -s arch=x86_64`), which is execssive (altough, scripts could easily generate that command line as well, if needed).

given the above, user currently has to do:

```
./gen_profile.sh windows > profile.windows
conan install zlib/1.2.11@ --profile profile.windows
```

this works already, and it's convinient, but it's a bit redundant. it could be improved:

```
./gen_profile.sh windows | conan install zlib/1.2.11@ --profile stdin
```

which is comaptible with old approach:
```
cat profile.windows | conan install zlib/1.2.11@ --profile stdin
```

okay, what might be a tricky to work with 2 profiles (build/host), as you can't pipe them that easy (or you need to pipe one into stderr, which is ugly).

so, maybe instead we could instruct conan to use profile script instead of profile:

```
conan install zlib/1.2.11@ --profile-script "./gen_profile.sh --windows"
conan install zlib/1.2.11@ --profile-script:build "./gen_profile_build.sh --windows" --profile-script:host "./gen_profile_host.sh --linux"
```

## advantages

- similar to [CGI](https://en.wikipedia.org/wiki/Common_Gateway_Interface) interface
- it works well with already written scripts to generate profiles (there are many of them)
- it supports arbitrary scripts (bash/perl/ruby/m4/etc) and executables (c++/go/java), not just python
- conan doesn't need to have a complex logic to support python profiles
- python profiles don't need to declare special classes, they can just output generated profile to stdout
- probably, it's not even needed to implement in conan client, if we allow command line extensions ([another idea suggested earlier](https://github.com/conan-io/conan/issues/7085))
- unix way, uses text interface
- doesn't require to store profile on disk
- no breakage (all tools, custom plug-ins, scripts, integrations still work with existing profile syntax)

## some notes on profiles

profiles could be defined as more or less serialization (textual .ini representation) of conan options, settings, build requirements, etc.

e.g. the following is a profile:
```
[settings]
os = Windows
[options]
boost:shared = False
```
and another representation is just a collection of command line arguments:
```
-s os=Windows -o boost:shared=False
```
(which is still incomplete right now - we can't easily serialize build require into command line args, for instance).

so profiles should be a preferred mechanism to pass information to conan client (CLI).

that's why it's important to have profiles well defined - they are now primary mechanism to interact with conan CLI.

the current .ini syntax is:
- declarative
- easy to read and understand
- easy to process programmatically: parse, generate, modify

not to mentioned, there are lots of tools tied with current syntax, at least some official:
- CLion plug-in
- Visual Studio extension
- conan center
- conan center web interface
- conan package tools (plus bincrafters package tools)

even conan CLI itself currently outputs the profile for some commands.

that doesn't include many 3rd-party scripts and plug-ins enterprise users may have.

if we replace .ini with PythonProfiles, the profiles will become fully turing complete, which will make it much harder to:
- understand them - you need follow the logic of code, which could be complicated
- process programmatically - good luck replacing os in PythonProfile with script

that would be a huge maitanance burden IMO for everyone, basically for all CI scripts, and all the custom integrations.

I suggest to keep .ini syntax and instead allow two modes of operation:
- specify a profile as is, meaning literally use a concents of the profile file (like we do now)
- specify a script to generate profile, meaning first invoke script (with arguments), then use its output as a profile

the format is the same - .ini. no breakage, but all the same benefits, everyone wins.
